<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Blackbaud Internet Solutions | Developer Guide | Custom Framework Parts</title> <link rel="icon" href="/bbis/assets/img/favicon.ico" type="image/ico"> <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"> <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"> <link rel="stylesheet" href="/bbis/assets/css/combine.site.css?v=2018-11-01-18:16:41"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-2418840-40', 'auto'); ga('send', 'pageview'); </script> </head> <body class="layout-compress section-guide subsection-custom-framework-parts"> <nav class="navbar" role="navigation" id="top"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bb-navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a href="/bbis/" class="navbar-brand"> <img src="/bbis/assets/img/logo-bbis.png" alt="Blackbaud Internet Solutions" class="img-responsive" /> </a> </div> <!-- navbar-header --> <div class="collapse navbar-collapse" id="bb-navbar"> <ul class="nav navbar-nav navbar-right"> <li > <a href="/bbis/start/"> Getting Started </a> </li> <li class="active"> <a href="/bbis/guide/"> Developer Guide </a> </li> <li > <a href="/bbis/reference/"> Technical Reference </a> </li> <li class=""> <a href="/bbis/code/"> Code Samples </a> </li> <li > <a href="/bbis/help/"> <i class="fa fa-fw fa-question-circle hidden-xs"></i> <span class="visible-xs-inline">Help</span> </a> </li> </ul> </div> <!-- .navbar-collapse --> </div> <!-- .container --> </nav> <!-- .navbar.navbar-inverse --> <div class="content"> <div class="container"> <div class="row"> <div class="col-md-3 hidden-xs hidden-sm"> <div class="sidebar"> <ul class="nav nav-pills nav-stacked nav-sidebar"> <!-- Ridiculous Bootstrap Scrollspy bug that required this nested linkage to function properly --> <li class="hidden"> <a href="#top">Top</a> <ul class="nav"> <li> <a href="#top">Top</a> </li> </ul> </li> <li class="back-to back-to-section"> <a href="/bbis/guide/"> Developer Guide </a> </li> <li class=""> <a href="/bbis/guide/advanced-donation-form/">Advanced Donation Form</a> </li> <li class=""> <a href="/bbis/guide/blackbaud-secure-payments/">Blackbaud Secure Payments</a> </li> <li class=""> <a href="/bbis/guide/custom-content-parts/">Custom Content Parts</a> </li> <li class=" active scrollspy-start "> <a href="/bbis/guide/custom-framework-parts/">Custom Framework Parts</a> <ul class="nav"> <li> <a href="#overview">Overview</a> </li> <li> <a href="#infinity-sdk">Using Infinity SDK</a> </li> <li> <a href="#create-projects">Creating Projects</a> </li> <li> <a href="#create-parts">Creating Parts</a> <ul class="nav"> <li> <a href="#create-parts-add-to-project">Add Parts to Project</a> </li> <li> <a href="#create-parts-post-build">Post Build Events</a> </li> <li> <a href="#create-parts-copy-files">Copy Files</a> </li> <li> <a href="#create-parts-test-build">Test Build</a> </li> <li> <a href="#create-parts-add-to-bbis">Add Parts to BBIS</a> </li> <li> <a href="#create-parts-create-instance">Create Instance</a> </li> <li> <a href="#create-parts-assembly-reference">Assembly Reference</a> </li> </ul> </li> <li> <a href="#example-pledge-form">Example - Custom Pledge Form</a> <!-- <ul class="nav"> <li> <a href="#example-pledge-form-infinity">Infinity Configuration</a> </li> <li> <a href="#example-pledge-form-create-form">Create Form</a> </li> <li> <a href="#example-pledge-form-ASDF">Populate Name Fields</a> </li> <li> <a href="#example-pledge-form-ASDF">Track Record Option</a> </li> <li> <a href="#example-pledge-form-ASDF">Infinity Web API Reference</a> </li> <li> <a href="#example-pledge-form-ASDF">Infinity Customization</a> </li> <li> <a href="#example-pledge-form-ASDF">Add Existing Folders</a> </li> <li> <a href="#example-pledge-form-ASDF">Custom Pledge Records</a> </li> <li> <a href="#example-pledge-form-ASDF">Infinity Add Form</a> </li> <li> <a href="#example-pledge-form-ASDF">Infinity Add Form DLL</a> </li> <li> <a href="#example-pledge-form-ASDF">Revenue Records</a> </li> <li> <a href="#example-pledge-form-ASDF">Field Validation</a> </li> <li> <a href="#example-pledge-form-ASDF">Update Logic</a> </li> </ul> --> </li> <li> <a href="#example-constituent-search">Example - Constituent Search</a> </li> <!-- <li> <a href="#example-event-registration">Example - Event Registration</a> </li> --> <li> <a href="#example-blackbaud-secure-payments">Example - Blackbaud Secure Payments</a> </li> </ul> </li> <li class=""> <a href="/bbis/guide/custom-handlers/">Custom Handlers</a> </li> <li class=""> <a href="/bbis/guide/user-imports/">User Imports</a> </li> <li class=""> <a href="/bbis/guide/responsive-design/">Responsive Design</a> </li> <li class="back-to back-to-top"> <a href="#top" class=""> <i class="fa fa-caret-square-o-up"></i> </a> </li> </ul> </div> </div> <!-- .col-md-3 --> <div class="col-md-9 readability"> <h2 id="overview">Custom Framework Parts</h2> <p class="alert alert-info"><span class="label label-info">Note</span> To create custom framework parts, you also need access to Custom parts in Blackbaud Internet Solutions, the ability to create part types, parts, and to add parts to a page. Knowledge of ASP.NET, user controls, Visual Basic, HTML and JavaScript is required. You also need access to upload the custom framework parts files to the server which hosts Blackbaud Internet Solutions.</p> <p>To define a custom part, you create two standard ASP.NET (.ascx) user controls. You create an Editor Control to edit the content for the part, and you create a Display Control to render that content on a web page.</p> <p><img src="../img/AnatomyOfCustomPart.png" alt="Anatomy of a Custom Framework Part" class="img-responsive" /></p> <p>Each user control is derived from a corresponding base class in the BBNCExtensions.dll assembly in the \bin folder of your installation directory. Each control inherits the API and Content properties that provide full access to the API and the content stored for your part.</p> <p>The Editor Control creates a user interface in Blackbaud Internet Solutions to edit the part’s content, while the Display Control provides the code and markup to render the content on a web page. While the Blackbaud Internet Solutions framework offers the correct user control at the correct time, it is up to your user controls to share common knowledge about the type of content that they edit, store, and render.</p> <p class="alert alert-info"><span class="label label-info">Note</span> The framework handles persisting simple content and providing it to each control when it is needed. This allows you to focus on custom functionality and leave the mechanics to the platform. However, if you include complex content from other systems or content that references other Blackbaud Internet Solutions (BBIS) tables, it is up to you to code the controls to manage the storage and retrieval of that content.</p> <p>Blackbaud Internet Solutions and your custom parts are built on the Microsoft ASP.NET platform, so your custom parts can take advantage of a wealth of standard APIs and services from the .NET framework, as well as a variety third-party .NET based components.</p> <p>After you create custom parts, you use the Infinity SDK to store and retrieve data. You can access existing data in BBIS through the *.WebApiClient.dlls available in the SDK. And you can create Infinity tables and CRUD processes with the SDK and then generate your own *.WebApiClient.dlls to access these tables for your custom parts.</p> <h3 id="infinity-sdk">Use the Infinity SDK with Custom Framework Parts</h3> <p>Previously, a part’s content was a serialized object that was stored and retrieved in the database by the CMS framework. A part defined the content class which the Editor and Display controls both knew about, and the framework delivered content to each control and offered functions to save it back to the database. This old concept is still supported and can be useful in some cases, such as the HTML (FTI) part that just stores one blob of HTML and has no need for SQL joins to other tables. In the SDK item template for a part, you get the boilerplate code to support this approach automatically (see the MyContent property). You can use it or ignore it.</p> <p>However, the SDK now allows you to create tables for a part’s content. You can use Infinity practices to define the table and its CRUD procedures via Infinity Specs. Then you can use the Infinity MetalWeb code generator to create strongly typed classes around these procedures. You can store and retrieve a part’s content data in exactly the same way as ANY Infinity data with the *.WebApiClient.dlls, which immediately makes your new content type part of the vast Infinity API.</p> <p>You can also use both approaches, but be sure to keep foreign key references out of the serialized approach because this prohibits database level referential integrity, as well as the safe export and import of your part.</p> <h3>WebApiClient Assemblies to Access CRM Data</h3> <p>The SDK includes BBMetalWeb assemblies for all CRM catalogs that are easily called using standard syntax from any web client app. To use BBMetalWeb assemblies in your parts project:</p> <ul> <li>Add a reference to the *.WebApiClient.dll assembly you need, such as Blackbaud.AppFx.Constituent.Catalog.WebApiClient.dll.</li> <li>Add a reference to Blackbaud.AppFx.</li> <li>Add a reference to Blackbaud.AppFx.WebAPI.</li> <li>Add a reference to Blackbaud.Appfx.XmlTypes.</li> </ul> <h3>The Web Service</h3> <p>NetCommunity communicates with The Raiser’s Edge through a web service located near the Raiser’s Edge database. This web service is how NetCommunity retrieves all CRM data from The Raiser’s Edge, including constituents, funds, code tables, queries, and much more.</p> <p>When we developed Blackbaud Internet Solutions as the Infinity version of NetCommunity, we created a service with an identical interface to communicate with Blackbaud CRM. The service fools Blackbaud Internet Solutions into thinking it is communicating with The Raiser’s Edge so that it will work as expected. The abstraction layer paid off in getting us to an Infinity version of NetCommunity in record time. In Blackbaud CRM, this service is referenced on the Web servicestab in Sites & settings.</p> <p><img src="../img/BlackbaudEnterpriseSettings.png" alt="" class="img-responsive" /></p> <p>Should you use this web service to get CRM data to and from your custom parts? Or should you use the vast array of Infinity APIs to access whatever you want? Either technique works, but here are key points to consider. As a rule of thumb, never call the service directly. The CMS framework wraps access to this service in cases where it would be advantageous for you to use, such as:</p> <ul> <li>To get a current user’s linked constituent data – handles caching, reflecting pending updates, etc.</li> <li>To get entries in a code table (caches supported common code tables such as states, titles, etc.)</li> <li>API server UI controls such as the Campaign/Funds/Appeals picker</li> <li>To prefill an API donation with constituent bio/address data</li> </ul> <p>A relatively small subset of data is available through the service. You can extend the service with the API, but that only makes sense for a Raiser’s Edge installation that does not have Infinity’s rich, web-based CRM API.</p> <p>Another important point about built-in CRM integration relates to record IDs. In The Raiser’s Edge, IDs (primary keys) are integers, but in Infinity, they are GUIDs. For the Blackbaud Internet Solutions version of the web service, we introduced an integer-GUID mapping concept for all Infinity tables accessed by the service. Otherwise, we would have had to change a TON of code to support GUIDs as keys to back office records, and it would no longer have worked for NetCommunity and The Raiser’s Edge.</p> <p>For example, when the CMS Donation Form part stores IDs for CRM funds to include in the form, it stores them as integers. For the most part, this integer-GUID mapping is transparent and only relevant when you use the service to get CRM data, especially if you mix and match approaches. It’s also important to know that certain API functions such as recording a donation expect integers for back office IDs (such as the designation and fund IDs on a donation). If you get designations from the service, you already have the integers. But if you get the IDs yourself, you have GUIDs and need to look up the integer-GUID mapping yourself to create an API donation transaction.</p> <h3>Built-in Transactions</h3> <p>As originally designed for The Raiser’s Edge, Blackbaud NetCommunity collects transactions for user sign-ups, constituent profile updates, donations, memberships, event registrations, and volunteering. These transactions are delivered to the CRM in a holding pen where users can review and approve them before importing the transactions into the CRM.</p> <p>Only user signups, profile updates, and donations are supported in the API.</p> <p>This support allows custom parts to capture these transactions and use the built-in web service to deliver them to Blackbaud CRM, where they benefit from the same review process. These transactions are also supported in Blackbaud Internet Solutions, and the <a href="http://github.com/blackbaud-community/BBIS-Donation-Transactions">BBIS-Donation-Transactions repo</a> shows a donation form in action. The donations API is particularly powerful because it also handles the clearing of credit cards, emailing of acknowledgements, and creation of donation transactions for download.</p> <p>If you need to go outside the box, the transaction delivery pipe is not available, and you must find your own route to record your transaction in Blackbaud CRM. You can record transactions directly to the database with WebApiClient.dll wrappers, or you can create your own holding pen with a user interface to review and approve transactions in Blackbaud CRM.</p> <h3>Debugging</h3> <p>For debugging, attach Visual Studio to all running w3wp processes and set the breakpoints you want.</p> <p><img src="../img/VisualStudioAttachToProcessScreen.png" alt="" class="img-responsive" /></p> <h3 id="create-projects">Creating Custom Framework Parts Projects</h3> <p>The SDK includes a project template to create a CMS Parts Project. The Parts project template creates an empty project with a reference the BBNCExtensions assembly, which is your key to the custom parts universe.</p> <p>This Part template creates the scaffold of a CMS part that consists of three project items.</p> <ol> <li>A web user control (ASCX) for the Display Control that provides the code and markup to render content on a web page.</li> <li>A web user control (ASCX) for the Editor Control that creates a user interface to edit the part’s content.</li> <li>A class to hold the part’s content/properties (optional).</li> </ol> <p>To deploy the custom part to your website, you must copy its files to the appropriate folders on your web server and then add the part to the Custom parts gallery in Administration. You can configure post-build events in to copy the files.</p> <p class="alert alert-warning"><span class="label label-warning">Warning</span> These steps require Visual Studio and the Infinity SDK. For more information about how to create a developer environment, see <a href="/bbis/start/#development-environment">Development Environment</a>.</p> <p class="alert alert-info"><span class="label label-info">Note</span> Subsequent tasks may require Administrator rights to folders on your developer machine. If you do not have Administrator rights enabled by default, you may have to run Visual Studio as an Administrator.</p> <ol> <li>Open Visual Studio.</li> <li> From Visual Studio, click File > New > Project.<br /> <img src="../img/FileNewProjectMenu_567x196.png" alt="" class="img-responsive" /> </li> <li> From the New Project screen, select Visual Basic > Blackbaud AppFx > Parts Project.<br /> <img src="../img/NewProjectPartsProjectScreen_569x425.png" alt="" class="img-responsive" /> </li> <li> Change the project and solution name.<br /> <img src="../img/ProjectAndSolutionName.png" alt="" class="img-responsive" /> </li> <li>Click OK. The solution appears.</li> <li>Save the project.</li> </ol> <h3 id="create-parts">Custom Framework Parts Creation</h3> <p>Custom parts are comprised of two ASP.NET user controls. It is assumed that the machine where you create custom parts has Blackbaud Internet Solutions installed along with IIS and Visual Studio 2008 or 2010 for the development environment.</p> <dl> <dt>Editor Control</dt> <dd>Creates the user interface to edit the part's content in Blackbaud Internet Solutions.</dd> <dt>Display Control</dt> <dd>Provides the code and markup to render the content on a web page.</dd> </dl> <p>The content for custom parts can come from a variety of sources. Content can be as simple as text or HTML stored in the BBIS database, or it can be data from the back office such as constituent giving history in Blackbaud CRM. Custom parts store content in the BBIS database, whether it’s the actual content or just the location of the content. Custom parts also store any design options for display or behavior in the database. Depending on the content, the Editor Control offers a place to edit the content or parameters to locate remote content. The Editor Control also allows users to edit design-time settings properties for display and behavior.</p> <p>A custom part also has a code-behind DLL assembly. This is where the part’s executable code lives for all of its associated user controls. This is a common ASP.NET practice.</p> <p>To install a custom part, you place all non-compiled files (.ascx files, images files, .js files, etc.) in the \NetCommunity\Custom folder of your installation directory. We recommend that you create subfolders in the \NetCommunity\Custom folder for each of your custom parts. In addition, you place all compiled files (your code behind DLL) and required references (.dll) in the \NetCommunity\bin folder.</p> <p class="alert alert-info"><span class="label label-info">Note</span> If you do not have a \Custom folder in the \NetCommunity folder for your installation directory, you must create one.</p> <p>After your files are in place, you can add custom parts to Blackbaud Internet Solutions from the Custom parts gallery in Administration. After this, the part is ready for use.</p> <h4 id="create-parts-add-to-project">Add a Custom Framework Part to a Parts Project</h4> <p class="alert alert-success"><span class="label label-success">Tip</span> Sometimes part types are referred to as parts. But parts are instances of part types. Custom parts are actually custom part types. You can create a part based on a custom part (type).</p> <ol> <li>Open the Parts project.</li> <li> From Solution Explorer, right-click the project and select Add > New Item. The Add New Item screen appears.<br /> <img src="../img/AddNewItemPartsProjectPartSolutionExplorer.png" alt="" class="img-responsive" /> </li> <li> Select Visual Basic > Blackbaud AppFx CMS > Part.<br /> <img src="../img/AddNewItemPartsProjectPartScreen.png" alt="" class="img-responsive" /> </li> <li> Change the name.<br /> <img src="../img/CustomPartName.png" alt="" class="img-responsive" /> </li> <li> Click Add. The part is added to the project.<br /> <img src="../img/PartsProjectAddedPartSolutionExplorer.png" alt="" class="img-responsive" /> </li> <li>Save the project.</li> </ol> <h4 id="create-parts-post-build">Adjust the Post-build Events</h4> <ol> <li>Ensure the Parts project is open.</li> <li> From Solution Explorer, right-click the project and select Properties.<br /> <img src="../img/PartsProjectMenuProperties_315x409.png" alt="" class="img-responsive" /><br /> The Properties appear.<br /> <img src="../img/ProjectProperties_432x347.png" alt="" class="img-responsive" /> </li> <li> Click Compile.<br /> <img src="../img/PropertiesCompile.png" alt="" class="img-responsive" /> </li> <li> Click Build Events.<br /> <img src="../img/PropertiesCompileBuildEvents_512x392.png" alt="" class="img-responsive" /><br /> The Build Events screen appears.<br /> <img src="../img/BuildEventsScreen.png" alt="" class="img-responsive" /> </li> <li> Click Edit Post-build.<br /> <img src="../img/EditPostBuild.png" alt="" class="img-responsive" /><br /> The Post-build Event Command Line screen appears. There are template XCOPY commands in the editor. These commands copy files from the built project to the BBIS installation.<br /> <img src="../img/PostBuildEventCommandLineScreen.png" alt="" class="img-responsive" /> </li> <li> Clear the template commands in Post-build event command line and replace the commands with these: <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-bat" data-lang="bat">xcopy "$(ProjectDir)*.ascx" "C:\Program Files\Blackbaud\NetCommunity\Custom\$(ProjectName)" /s /I /y
xcopy "$(TargetDir)$(ProjectName).*" "C:\Program Files\Blackbaud\NetCommunity\Bin\" /y</code></pre></div> </div> Adjust the paths for your BBIS installation. The first line copies the ASCX forms and the second line copies the DLL for the Part. Once you begin to reference other items in the project, such as API DLLs, you may have to add or adjust lines. For example, this will copy WebAPIClient DLLs: <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-bat" data-lang="bat">xcopy "$(TargetDir)*.WebApiClient.*" "C:\Program Files\Blackbaud\NetCommunity\Bin\" /y</code></pre></div> </div> </li> <li>Click OK. You return to the Build Events screen.</li> <li>Click OK. You return to the project's properties.</li> <li>Save the project.</li> </ol> <h4 id="create-parts-copy-files">Copy the Files for a Custom Framework Part</h4> <ol> <li>In Visual Studio, open the properties sheet for the Parts project.</li> <li> On the Compile tab, click Build Events. The Build Events screen appears.<br /> <img src="../img/VisualStudioBuildEventsScreen.png" alt="" class="img-responsive" /> </li> <li> Click Edit Post-build. The Post-build Event Command Line appears.<br /> <img src="../img/VisualStudioPostBuildEventCommandLine.png" alt="" class="img-responsive" /> </li> <li> In the command line edit window, replace the default post-build event commands with the following commands and then replace the destination paths with the locations in your installation directory: <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-bat" data-lang="bat">copy "$(ProjectDir)*.ascx" "C:\Infinity\DEV\Firebird\ClassicCMS\Web\Content\Portal\Custom\$(ProjectName)" /s /I /y
xcopy "$(TargetDir)$(ProjectName).*" "C:\Infinity\DEV\Firebird\ClassicCMS\Web\Content\Portal\bin" /y
xcopy "$(TargetDir)*.WebApiClient.*" "C:\Infinity\DEV\Firebird\ClassicCMS\Web\Content\Portal\bin" /y</code></pre></div> </div> </li> <li>Replace the destination paths in the commands with the appropriate locations in your installation directory. Remember to place your .ascx files in the \custom folder or a subfolder and your code-behind DLL and any *.webApiClient.dlls in the \bin folder.</li> <li> When you successfully recompile, these commands copy files to your installation folder. <ul> <li>The first command copies.ascx user controls from your project to the \NetCommunity\Custom folder or a subfolder. In our example, the command copies the file to the \Hello subfolder.</li> <li>The second command copies the DLL to the \bin folder of your installation. The command includes “$(ProjectName)” to ensure that you only copy the DLL for your project and not other DLLs that you reference that are in the \bin folder.</li> </ul> </li> </ol> <p class="alert alert-info"><span class="label label-info">Note</span> For more complex custom parts, you can add commands to copy related files such as images, scripts, and style sheets.</p> <h4 id="create-parts-test-build">Test the Build and Post-build Commands</h4> <ol> <li>Open the Parts project.</li> <li> <p>Right-click the project and select Build. A successful build should look like this in the Output window:</p><pre>
------ Build started: Project: PartsProjectExample, Configuration: Debug Any CPU ------
PartsProjectExample -> C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\bin\PartsProjectExample.dll
C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\PartExampleDisplay.ascx
C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\PartExampleEditor.ascx
2 File(s) copied
C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\bin\PartsProjectExample.dll
C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\bin\PartsProjectExample.pdb
C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\bin\PartsProjectExample.xml
3 File(s) copied
========== Build: 1 succeeded or up-to-date, 0 failed, 0 skipped ==========
    </pre><p>Without Administrator rights, the output will look something like this:</p><pre>
------ Build started: Project: PartsProjectExample, Configuration: Debug Any CPU ------
PartsProjectExample -> C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\bin\PartsProjectExample.dll
C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\PartExampleDisplay.ascx
Access denied
C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\bin\PartsProjectExample.dll
Access denied
c:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Common.targets(3717,9): error MSB3073: The command "xcopy "C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\*.ascx" "C:\Program Files\Blackbaud\NetCommunity\Custom\PartsProjectExample" /s /I /y
c:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Common.targets(3717,9): error MSB3073: xcopy "C:\Users\TomTr\Documents\Visual Studio 2010\Projects\PartsProjectExample\PartsProjectExample\bin\PartsProjectExample.*" "C:\Program Files\Blackbaud\NetCommunity\Bin\" /y" exited with code 4.
========== Build: 0 succeeded or up-to-date, 1 failed, 0 skipped ==========
    </pre></li> <li> Browse to the files in Windows Explorer.<br /> <img src="../img/CopiedFiles.png" alt="" class="img-responsive" /> </li> </ol> <h4 id="create-parts-add-to-bbis">Add a Custom Framework Part to Blackbaud Internet Solutions</h4> <ol> <li>Log into BBIS as a supervisor and navigate to the Administration page.</li> <li> Click Custom parts.<br /> <img src="../img/AdministrationCustomParts.png" alt="" class="img-responsive" /><br /> The Custom Parts page appears.<br /> <img src="../img/CustomPartsPage1_545x353.png" alt="" class="img-responsive" /><br /> </li> <li>Click New custom part.<br /><img src="../img/NewCustomPartButton.png" alt="" class="img-responsive" /></li> <li>In Name, enter a name for the custom part (type).</li> <li> <p>In Display Control Source, enter the path to the ASP.NET display user interface (ASCX file) that the post-build events copied to the BBIS installation. For example: Custom/PartsProjectExample/PartExampleDisplay.ascx.</p> <p class="alert alert-warning"><span class="label label-warning">Warning</span> Enter a virtual path. Otherwise, you will get an error message like this:</p> <p><img src="../img/VirtualNotPhysicalError.png" alt="" class="img-responsive" /></p> </li> <li> In Edit Control Source, enter the path to the ASP.NET editor user interface (ASCX file) that the post-build events copied to the BBIS installation. For example: Custom/PartsProjectExample/PartExampleEditor.ascx<br /> <img src="../img/PartExampleCreateCustomPart.png" alt="" class="img-responsive" /> </li> <li>Select the Requires SSL checkbox if the part contains, displays, or collects, sensitive data, such as credit card information. When you select this checkbox and you configure an SSL certificate on your web site, any page to which you add this part will use a secure (https://) URL.</li> <li>Click Save</li> </ol> <p class="alert alert-success"><span class="label label-success">Tip</span> Sometimes part types are referred to as parts. But parts are instances of part types. Custom parts are actually custom part types. You can create a part based on a custom part (type).</p> <h4 id="create-parts-create-instance">Create a Part Based on a Custom Framework Part Type</h4> <ol> <li> Click Create > New part.<br /> <img src="../img/CreateNewPart.png" alt="" class="img-responsive" /><br /> The New Part Webpage Dialog appears. </li> <li> From Part type, click the binoculars. Selections for part (type) appear.<br /> <img src="../img/SelectParttype.png" alt="" class="img-responsive" /> </li> <li> Scroll or browse to the custom part (type).<br /> <img src="../img/SelectedCustomPart.png" alt="" class="img-responsive" /> </li> <li>Enter a name for the new part. Do not use the same name as the custom part (type). The name must be unique.</li> <li> <p>Click Next. A tabbed set of options appears. You can adjust those as necessary. For more information, see Website Design Guide.</p> <p class="alert alert-warning"><span class="label label-warning">Warning</span> If the version of the reference to BBNCExtensions.dll in your parts project does not match the version of the BBNCExtensions.dll used the compiler (BBIS), you may get an error like this:</p> <p><img src="../img/CompilationError_524x366.png" alt="" class="img-responsive" /></p> <p>To correct this error, you can change the reference in your parts project to the copy of the DLL used by the compiler (BBIS). For more information, continue to the next section.</p> </li> <li>Click Save. The new part is created.</li> </ol> <h4 id="create-parts-assembly-reference">Change the Reference for BBNCExtensions.dll</h4> <ol> <li>Open the Parts project.</li> <li>From Solution Explorer, right-click the project and select Properties. The project's properties appear.</li> <li>Click References.</li> <li> <p>Select the existing reference to BBNCExtensions.dll and click Remove.</p> <p><img src="../img/ReferenceToBBNCExtensionsDLL_633x271.png" alt="" class="img-responsive" /></p> </li> <li> <p>Click Add. The Add Reference screen appears.</p> <p><img src="../img/AddReferenceScreen_354x465.png" alt="" class="img-responsive" /></p> </li> <li> <p>Click the Browse tab. Browse to BBNCExtensions.dll in the BBIS installation. For example: C:\Program Files\Blackbaud\NetCommunity\Bin\BBNCExtensions.dll.</p> <p><img src="../img/AddReferenceScreenBBNCExtensionsLocation_357x468.png" alt="" class="img-responsive" /></p> </li> <li>Click OK.</li> <li>Save the project. Then build the project.</li> </ol> <h3 id="example-pledge-form">Custom Pledge Form</h3> <p>This example includes step-by-step instructions to create a custom part that meets these design requirements and learning objectives:</p> <h4>Design requirements: Create a custom pledge form for Blackbaud Internet Solutions</h4> <ol> <li>Any required field for a pledge transaction that is not on this form will be defaulted or calculated in some way.</li> <li>Name information for the user will appear at the top of the form. <ul> <li> If the user is logged in <ul> <li>form will be populated with that login’s user information</li> <li>fields will be read-only</li> </ul> </li> <li> If the user is not logged in <ul> <li>form will not be populated</li> <li>fields will be writeable</li> </ul> </li> </ul> </li> <li>Email address will be populated with constituent or login information when possible. But it will be writeable and include simple email address format validation. For linked users, when the email address is changed, a new email addressed will be added to the constituent record in Blackbaud CRM.</li> <li>Amount will handle US currency values.</li> <li>When the user hits the Pledge button, something will be sent to Infinity via a web API. This will be either custom content created with the Infinity SDK or a new pledge transaction. This demonstrates using an the web API for an Add Data Form to write to an Infinity record, one out-of-the box and one created with the SDK.</li> <li>The behavior of the Pledge button will be configurable by a Blackbaud Internet Solutions administrator. Here are the two options: <ol> <li>Write to a custom content table created with Infinity SDK</li> <li>For non-linked logins, write to a custom content table and for linked logins create pledge transaction in Infinity for that constituent</li> </ol> </li> </ol> <h4>Objectives</h4> <ol> <li>Configure Infinity application (selected items)</li> <li>Create parts projects</li> <li>Add custom parts to parts projects</li> <li>Create a custom form (UI design)</li> <li>Create a custom form (form behavior)</li> <li>Add Infinity record customizations for Blackbaud Internet Solutions parts</li> <li>Add a configuration setting to a custom form (UI design)</li> <li>Prepare to use Infinity API assemblies in a Blackbaud Internet Solutions custom part</li> <li>Create a custom form (write logic implementation)</li> </ol> <h4>Add a Designation to Infinity</h4> <p class="alert alert-info"><span class="label label-info">Note</span> This is a dependency for the custom pledge form example. Designations are probably already configured for Fundraising in your Infinity solution. However, if you are developing in an installation that has not been configured, these are the minimum steps to establish a designation. For information about fundraising hierarchies and designations, see <a href="https://www.blackbaud.com/files/support/guides/enterprise/fundrais.pdf" target="_blank">Fundraising Guide</a>.</p> <ol> <li>Ensure there is at least one fundraising purpose type. This a dependency for fundraising hierarchies. You can add a fundraising purpose type from Fundraising > Configuration > Fundraising purpose types. <p class="alert alert-info"><span class="label label-info">Note</span> If this option does not appear under Configuration, go to Administration > Application > Features and search for fundraising purpose types functionality. There are Add and Edit Data Forms and a delete record operation. Fundraising purpose types are stored as a simple data list.</p></li> <li>Ensure there is at least on fundraising hierarchy. This is a dependency for designations. You can add a fundraising hierarchy from Fundraising > Configuration > Fundraising hierarchies.</li> <li>Ensure there is at least one designation. This is a dependency for the sample donation form. You can add a designation from Fundraising > Configuration > Fundraising hierarchies.</li> </ol> <h4>Ensure Post Dates are Configured</h4> <p class="alert alert-info"><span class="label label-info">Note</span> This is a dependency to create a Revenue transaction. For more information about general ledger setup, see the General Ledger Setup chapter of the <a href="https://www.blackbaud.com/files/support/guides/enterprise/admin.pdf" target="_blank">Administration Guide</a>.</p> <ol> <li>From the Infinity application such as Blackbaud CRM, navigate to Administration.</li> <li> Click General Ledger setup.<br /> <img src="../img/AdministrationGeneralLedgerSetup.png" alt="" class="img-responsive" /> </li> <li> Click the account system.<br /> <img src="../img/GeneralLedgerSetupAccountSystemSelection.png" alt="" class="img-responsive" /> </li> <li> Fully configure the account system. Or, if General Ledger functionality is not needed, under Configuration, select the task to Disable General Ledger.<br /> <img src="../img/GeneralLedgerDisabled_1028x232.png" alt="" class="img-responsive" /> </li> </ol> <h4>Create a Custom Pledge Form (Design)</h4> <ol> <li>Open your Parts project in Visual Studio. This example uses a project called PartsProjectExample.</li> <li>Add a new custom part (type) to the project called CustomPledgeForm.</li> <li> A VB file may appear in an editor. For example, CustomPledgeFormProperties.vb may appear. You will use this file later. But for now, close the VB files for properties and take a look at Solution Explorer<br /> <img src="../img/CustomPledgeFormPropertiesVB.png" alt="" class="img-responsive" /> </li> <li> Open CustomPledgeFormDisplay.ascx for editing in Designer. Right-click CustomPledgeFormDisplay.vb and select View Designer.<br /> <img src="../img/SolutionExplorerDisplayFormHighlighted.png" alt="" class="img-responsive" /><br /> Right-clicking...<br /> <img src="../img/ViewDesignerForCustomPledgeFormDisplay.png" alt="" class="img-responsive" /><br /> The ASCX form appears in Design Mode.<br /> <img src="../img/DesignerFor CustomPledgeFormDisplayASCX.png" alt="" class="img-responsive" /> </li> <li> Click View > Toolbox. The Toolbox appears.<br /> <img src="../img/ToolboxAppears.png" alt="" class="img-responsive" /> </li> <li> Add a break after [lblError]. You can place the cursor after the text and press ENTER.<br /> <img src="../img/AddABreak.png" alt="" class="img-responsive" /> </li> <li> Add a Panel to the form. Adjust the height and width so that there is space to work in.<br /> <img src="../img/AddAPanel_461x378.png" alt="" class="img-responsive" /> </li> <li> Change the panel ID to PanelPledgeForm. To adjust the panel properties, you can right-click the panel and select Properties.<br /> <img src="../img/PanelPropertiesFromRightClickMenu.png" alt="" class="img-responsive" /><br /> The Properties window appears. ID is probably at the bottom.<br /> <img src="../img/PropertiesWindow.png" alt="" class="img-responsive" /><br /> Changing Panel1 to PanelPledgeForm...<br /> <img src="../img/PanelPledgeForm.png" alt="" class="img-responsive" /> </li> <li> Add a label inside the Panel.<br /> <img src="../img/AddALabel_474x370.png" alt="" class="img-responsive" /> </li> <li>Change the label ID to LabelPledgeForm. Change the text of the label to Make a pledge.</li> <li>Add a line break. Place the cursor next to the label and press ENTER.</li> <li> Add an HTML Table.<br /> <img src="../img/AddAnHTMLTable_481x362.png" alt="" class="img-responsive" /> </li> <li> Delete the right-most column so that there are three rows and two columns.<br /> <img src="../img/DeleteRightMostColumn_491x232.png" alt="" class="img-responsive" /> </li> <li>Adjust the widths of the columns as necessary.</li> <li> Add a Label to each of the cells in the left column. Change the text to First, Middle, and Last respectively. Change the IDs to LabelFirst, LabelMiddle, and LabelLast.<br /> <img src="../img/AddNameLabels.png" alt="" class="img-responsive" /> </li> <li> Add a TextBox to each of the cells in the right column. Change the IDs to TextBoxFirst, TextBoxMiddle, TextBoxLast respectively.<br /> <img src="../img/CustomPledgeFormDisplayNamesFieldsAdded.png" alt="" class="img-responsive" /> </li> <li>Add a break after the table.</li> <li>Add a Label for Email address and a break after that. Change the ID for the Label to LabelEmail.</li> <li>Add a break.</li> <li>Add a TextBox for email address. Change the ID for the TextBox to TextBoxEmail.</li> <li>Add a break.</li> <li>Add a Label for Amount. Change the ID for the Label to LabelAmount.</li> <li>Add a break.</li> <li>Add a TextBox for amount. Change the ID for the TextBox to TextBoxAmount.</li> <li>Add a break.</li> <li> Add a Button with the text Pledge. Change the ID for the Button to ButtonPledge.<br /> <img src="../img/CustomPledgeFormDesign.png" alt="" class="img-responsive" /> </li> </ol> <h4>Create a Custom Pledge Form Editor (Design)</h4> <ol> <li>Open your Parts project in Visual Studio.</li> <li> Open CustomPledgeFormEditor.ascx for editing in Designer.<br /> <img src="../img/CustomPledgeFormEditorDesignASCX.png" alt="" class="img-responsive" /> </li> <li>Delete the label that contains this text: "This part does not have any design time options"</li> <li>Add a break.</li> <li>Create the interface for the form's configuration option. The option is to which record to write pledge information: <ul> <li>Write to a custom content table created with the Infinity SDK</li> <li>For non-linked logins and anonymous users, write to a custom content table and for linked logins create a pledge transaction in Infinity for that constituent.</li> </ul> </li> <li> Add a CheckBox with this Text and ID: <ul> <li>Only write to custom pledge record</li> <li>CheckBoxOnlyWriteToCustomPledgeRecord</li> </ul> </li> <li> Add some paragraphs with this explanation: <ul> <li>When this is selected, any time the Pledge button is clicked, the details will be written to the custom pledge record USR_CUSTOMPLEDGE using the custom pledge Add Data Form accessed through a BBMetalWeb generated DLL.</li> <li> When this is not selected, for logged in users with linked accounts, the details will be written to a new pledge transaction using a DLL to access a web API. For anonymous users, the information will be written to USR_CUSTOMPLEDGE using the custom pledge Add Data Form accessed through a BBMetalWeb-generated DLL.<br /> <img src="../img/CustomPledgeFormEditorDesignFinished.png" alt="" class="img-responsive" /> </li> </ul> </li> <li>Save the form.</li> </ol> <h4>Populate the Name Fields</h4> <ol> <li>From Visual Studio, open the code-behind VB file for CustomPledgeFormDisplay.ascx (CustomPledgeFormDisplay.ascx.vb).</li> <li>Create a InitializeForm Sub for the custom pledge form.</li> <li> Call the InitializeForm Sub from the Page_Load Sub. <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    InitializeForm()
End Sub</code></pre></div> </div> </li> <li>In the InitializeForm sub, check to see whether the current user is anonymous. Use the <a href="/bbis/reference/bbncextensions/P_BBNCExtensions_API_Users_Users_CurrentUser.htm">CurrentUser property</a> in the <a href="/bbis/reference/bbncextensions/P_BBNCExtensions_API_Users_Users_CurrentUser.htm">BBNCExtensions.API.Users namespace</a> to get the current user. Users have the <a href="/bbis/reference/bbncextensions/P_BBNCExtensions_API_Users_User_IsAnonymous.htm">IsAnonymous property</a>.</li> <li> Create a conditional that uses the value of the check as a condition. If the user is not anonymous, assign FirstName for CurrentUser to the text of TextBoxFirst and LastName to TextBoxLast. Then disable each name field by setting the Enabled property for the field to False. If the user is anonymous, leave the fields alone. <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Private Sub InitializeForm()
    'If there is a login, get the first and last name for the logged in user.
    'Populate the First and Last fields on the form. Disable the First, Middle,
    'and Last fields. Otherwise, leave the fields enabled and writeable.
    If Not API.Users.CurrentUser.IsAnonymous Then
        TextBoxFirst.Text = API.Users.CurrentUser.FirstName
        TextBoxLast.Text = API.Users.CurrentUser.LastName
        TextBoxFirst.Enabled = False
        TextBoxMiddle.Enabled = False
        TextBoxLast.Enabled = False
    End If
End Sub</code></pre></div> </div> </li> <li> After you build the project and copy the files to your BBIS installation, the part should behave as follows: When accessed without logging in...<br /> <img src="../img/NameFieldsBlankAndEnabled.png" alt="" class="img-responsive" /><br /> While logged in, as Supervisor in this case...<br /> <img src="../img/NameFieldsPopulatedAndDisabled.png" alt="" class="img-responsive" /> </li> </ol> <h4>Track the Record Option</h4> <ol> <li>Open the form properties VB file that was created when you added the custom part (type). For example, open CustomPledgeFormProperties.vb.</li> <li>Declare a Boolean variable that tracks whether to write only to the custom pledge record: <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Public OnlyWriteToCustomPledgeRecord As Boolean</code></pre></div> </div> </li> <li> Save the file. The display and editor forms will check this variable to determine which record to use. <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Public Class CustomPledgeFormProperties
    Public OnlyWriteToCustomPledgeRecord As Boolean
End Class</code></pre></div> </div> </li> </ol> <h4>Add Infinity Web API References</h4> <ol> <li>Open the Parts project.</li> <li>From Solution Explorer, right-click the project and select Properties. The project's properties appear.</li> <li>Click References.</li> <li> Click Add. The Add Reference screen appears.<br /> <img src="../img/AddReferenceScreen_354x465.png" alt="" class="img-responsive" /> </li> <li>Click the Browse tab. Browse to the Bin folder in your BBIS installation. For example: C:\Program Files\Blackbaud\NetCommunity\Bin</li> <li> Select these DLLs: <ul> <li>Blackbaud.AppFx</li> <li>Blackbaud.AppFx.WebAPI</li> <li>Blackbaud.Appfx.XmlTypes</li> </ul><br /> <img src="../img/AddReferenceScreenWebAPIDLLs_369x484.png" alt="" class="img-responsive" /> </li> <li>Click OK.</li> <li>Save the project. Then build the project.</li> </ol> <h3 id="example-constituent-search">Constituent Search</h3> <p>This example includes step-by-step instructions to create a custom part that meets these design requirements and learning objectives:</p> <h4>Design requirements: Create a custom individual search (Blackbaud CRM constituent) form for Blackbaud Internet Solutions</h4> <ol> <li>A label will appear at the top of the display form. The label's text depends on a constituency selected in the editor form.</li> <li> <ul> <li> If All is selected on the editor form:<br /> <code>Individual Search</code> </li> <li> If a constituency is selected on the editor form:<br /> <code>Individual Search: &lt;constituency&gt; constituency</code> </li> <li> For example:<br /> <code>Individual Search: Staff constituency</code> </li> </ul> </li> <li>The display form will include a Search criteria section that includes labels and text boxes for first, middle, and last name.</li> <li>The display form will include a Search button. When clicked, the search button will initiate a individual constituent search in the Blackbaud CRM database. The search will be filtered by constituency depending on the selection on the editor form.</li> <li>The display form will include a First result section that shows the name, primary email address, and primary phone number for the first constituent returned by the search. If no email address or phone is found, the label will indicate that. If no results are returned, this section will indicate that.</li> <li>The display form will include an All results section that lists all of the constituents returned by the search.</li> <li>The editor form will include a radio button list that includes items for each system and user-defined constituency. The list will also include an All item to indicate to perform a search that is not filtered by constituency.</li> <li>The editor form will include text that explains the configuration option:</li> <li>Select the constituency on which to filter the individual search.</li> </ol> <h4>Objectives</h4> <ol> <li>Create parts projects</li> <li>Add custom parts to parts projects</li> <li>Create a custom form (UI design)</li> <li>Create a custom form (form behavior)</li> <li>Add a configuration setting to a custom form (UI design)</li> </ol> <h4>Create a Custom Constituent Search (Design)</h4> <ol> <li> Open your Parts project in Visual Studio. This example uses a project called SearchPartExample.<br /> <img src="../img/SearchPartExample.png" alt="" class="img-responsive" /> </li> <li>Add a new custom part (type) to the project called CustomSearchForm.</li> <li> A VB file may appear in an editor. For example, CustomSearchFormProperties.vb may appear. You will use this file later. But for now, close the VB files for properties and take a look at Solution Explorer.<br /> <img src="../img/CustomSearchFormPropertiesVB.png" alt="" class="img-responsive" /> </li> <li> Open CustomSearchFormDisplay.ascx for editing in Designer. Right-click CustomSearchFormDisplay.vb and select View Designer.<br /> <img src="../img/CustomSearchFormDisplayHighlighted.png" alt="" class="img-responsive" /><br /> Right-clicking...<br /> <img src="../img/ViewDesignerForASCXCustomSearchForm.png" alt="" class="img-responsive" /><br /> The ASCX form appears in Design Mode.<br /> <img src="../img/ASCXInDesignerCustomSearchForm.png" alt="" class="img-responsive" /> </li> <li> Click View > Toolbox. The Toolbox appears.<br /> <img src="../img/ToolboxAndDesignerCustomSearchFormDisplay.png" alt="" class="img-responsive" /> </li> <li> Add a break after [lblError]. You can place the cursor after the text and press ENTER.<br /> <img src="../img/AddABreakCustomSearchFormDisplay.png" alt="" class="img-responsive" /> </li> <li>Add two Panels to the form. Order the panels vertically and adjust the height and width so that there is space to work in.</li> <li> Change the panel IDs to PanelSearchFormEntry and PanelSearchFormResults. To adjust the panel properties, you can right-click the panel and select Properties.<br /> <img src="../img/PanelPropertiesFromRightClickMenuPanelSearchFormEntry.png" alt="" class="img-responsive" /><br /> The Properties window appears. ID is probably at the bottom. Changing Panel1 to PanelSearchFormEntry...<br /> <img src="../img/PanelSearchFormEntryProperties.png" alt="" class="img-responsive" /> </li> <li> Add a label inside the first Panel.<br /> <img src="../img/AddALabelCustomSearchFormEntryPanel.png" alt="" class="img-responsive" /> </li> <li> Change the label ID to LabelSearchFormEntry. Change the text of the label to Search criteria.<br /> <img src="../img/ChangeTheLabelAndID.png" alt="" class="img-responsive" /> </li> <li> Add a break and an HTML table with labels and text boxes for name information. Also, add a button with Search as the text.<br /> <img src="../img/SearchCriteriaUI.png" alt="" class="img-responsive" /> <table class="table table-striped"> <tr> <th>Text</th> <th>Control</th> <th>ID</th> </tr> <tr> <td>First</td> <td>System.Web.UI.WebControls.Label</td> <td>LabelFirst</td> </tr> <tr> <td>Middle</td> <td>System.Web.UI.WebControls.Label</td> <td>LabelMiddle</td> </tr> <tr> <td>Last</td> <td>System.Web.UI.WebControls.Label</td> <td>LabelLast</td> </tr> <tr> <td></td> <td>System.Web.UI.WebControls.TextBox</td> <td>TextBoxFirst</td> </tr> <tr> <td></td> <td>System.Web.UI.WebControls.TextBox</td> <td>TextBoxMiddle</td> </tr> <tr> <td></td> <td>System.Web.UI.WebControls.TextBox</td> <td>TextBoxLast</td> </tr> <tr> <td>Search</td> <td>System.Web.UI.WebControls.Button</td> <td>ButtonSearch</td> </tr> </table> </li> <li> To the second panel, add fields for results. <table class="table table-striped"> <tr> <th>Text</th> <th>Control</th> <th>ID</th> </tr> <tr> <td>Name</td> <td>System.Web.UI.WebControls.Label</td> <td>LabelName</td> </tr> <tr> <td>Email</td> <td>System.Web.UI.WebControls.Label</td> <td>LabelEmail</td> </tr> <tr> <td>Phone</td> <td>System.Web.UI.WebControls.Label</td> <td>LabelPhone</td> </tr> </table> </li> </ol> <h4>Create a Custom Constituent Search Editor (Design)</h4> <ol> <li>Open your Parts project in Visual Studio.</li> <li> Open CustomSearchFormEditor.ascx for editing in Designer.<br /> <img src="../img/CustomSearchFormEditorInDesigner.png" alt="" class="img-responsive" /> </li> <li>Delete the label that contains this text: "This part does not have any design time options"</li> <li>Add a break.</li> <li> Create the interface for the form's configuration options. The options are constituencies on which to filter: <ol> <li>Add a RadioButtonList.</li> <li>Change the ID to RadioButtonListConstituencies.</li> <li> From the list tasks menu, select Edit Items. The ListItem Collection Editor screen appears. <p class="alert alert-info"><span class="label label-info">Note</span> This is only to add some defaults so that the editor form shows something in the IDE. The members of the collection will be populated dynamically based on Infinity constituencies retrieved with the Infinity web API.</p> <img src="../img/ListItemCollectionEditorUnpopulated.png" alt="" class="img-responsive" /> </li> <li>Click Add. A new member of the collection is added.</li> <li>From Text, enter Board member</li> <li> Add members for Donor, Fundraiser, and Volunteer.<br /> <img src="../img/ListItemCollectionEditorPopulated.png" alt="" class="img-responsive" /> </li> <li>Click OK.</li> <li> Add text that explains the options:<br /> Select constituency on which to filter the individual search.<br /> <img src="../img/RadioButtons.png" alt="" class="img-responsive" /> </li> <li>Save CustomSearchFormEditor.ascx.</li> </ol> </li> </ol> <h4>Track the Selected Constituencies</h4> <ol> <li>Open the form properties VB file that was created when you added the custom part (type). For example, open CustomSearchFormProperties.vb.</li> <li> Declare Boolean variables that track which constituency was selected on the editor form: <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Public Class CustomSearchFormProperties
    Public Constituency As String
    Public ConstituencyID As System.Guid
    Public SearchAll As Boolean
End Class</code></pre></div> </div> </li> <li>Save the file. The display and editor forms will check these variables to determine which record to use.</li> </ol> <h4>Add Infinity Web API References</h4> <ol> <li>Open the Parts project.</li> <li>From Solution Explorer, right-click the project and select Properties. The project's properties appear.</li> <li>Click References.</li> <li> Click Add. The Add Reference screen appears.<br /> <img src="../img/AddReferenceScreen_354x465.png" alt="" class="img-responsive" /> </li> <li>Click the Browse tab. Browse to the Bin folder in your BBIS installation. For example: C:\Program Files\Blackbaud\NetCommunity\Bin</li> <li> Select these DLLs: <ul> <li>Blackbaud.AppFx</li> <li>Blackbaud.AppFx.WebAPI</li> <li>Blackbaud.Appfx.XmlTypes</li> </ul> <img src"../img/AddReferenceScreenWebAPIDLLs_369x484.png" alt="" class="img-responsive" /> </li> <li>Click OK.</li> <li>Save the project. Then build the project.</li> </ol> <h4>Change the Top Label Based on Selected Constituency</h4> <p>To change a label based on the part's content properties, in the display form code (CustomSearchFormDisplay.ascx.vb), add this for the page load:</p> <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

        If MyContent.Constituency = "All" Then
            LabelConstituency.Text = "Individual Search"
        Else
            LabelConstituency.Text = "Individual Search: " + MyContent.Constituency + " constituency"
        End If
    End Sub</code></pre></div> </div> <p>mContent is an instance of a properties class called CustomSearchFormProperties, which is a part of the project.</p> <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Public Class CustomSearchFormProperties
    Public Constituency As String
    Public ConstituencyID As System.Guid
    Public SearchAll As Boolean
End Class</code></pre></div> </div> <h4>Find an Infinity Search for a Constituent</h4> <ol> <li> Open the Infinity web client. For example:<br /> <img src="../img/BlackbaudEnterpriseCRMHome.png" alt="" class="img-responsive" /> </li> <li> Navigate to Administration > Application > Features > Search list search. The Search List Search screen appears.<br /> <img src="../img/SearchListSearchScreen_516x420.png" alt="" class="img-responsive" /> </li> <li> In Name, enter Constituent and click Search.<br /> <img src="../img/SearchListSearchScreenPopulated_522x426.png" alt="" class="img-responsive" /> </li> <li> Select the search list with the name Constituent Search. The metadata page for the search list appears.<br /> <img src="../img/ConstituentSearchListMetadataPage.png" alt="" class="img-responsive" /><br /> Note the System record ID for the search list: 23c5c603-d7d8-4106-aecc-65392b563887 </li> </ol> <h4>Find the API DLL for the Constituent Search</h4> <p>Please refer to Find the API DLL for the Pledge Add Form (and add a reference to it). But look for constituent search instead.</p> <h4>Functions to Search for Individuals in Infinity</h4> <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Private Function ReturnIndividualSearchIDs(ByVal ConstituencyID As System.Guid)
  'This is for the case where a constituency is chosen.
  'Return an array of String that contains IDs for individuals in Infinity.
  'Access an individual search feature in Infinity with the Constituent catalog
  'web API WebAPIClient DLL. Only return results for the constituency chosen
  'in the part's editor. The get IDs request requires a sevice provider. 
  'The service provider is established by Blackbaud Internet Solutions: 
  'Me.AP.AppFxWebServiceProvider. This uses BBNCExtensions.
  Dim IndividualSearchFilter As New Blackbaud.AppFx.Constituent.Catalog.WebApiClient.SearchLists.Constituent.IndividualSearchFilterData
  Dim IndividualIDs As String()
  IndividualSearchFilter.FIRSTNAME = TextBoxFirst.Text
  IndividualSearchFilter.MIDDLENAME = TextBoxMiddle.Text
  IndividualSearchFilter.KEYNAME = TextBoxLast.Text
  IndividualSearchFilter.INCLUDEINDIVIDUALS = True
  IndividualSearchFilter.INCLUDEGROUPS = False
  IndividualSearchFilter.INCLUDEINACTIVE = False
  IndividualSearchFilter.INCLUDENONCONSTITUENTRECORDS = False
  IndividualSearchFilter.INCLUDEORGANIZATIONS = False
  IndividualSearchFilter.CONSTITUENCY = ConstituencyID
  IndividualIDs = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.SearchLists.Constituent.IndividualSearch.GetIDs(Me.API.AppFxWebServiceProvider, IndividualSearchFilter)
  Return IndividualIDs
End Function

Private Function ReturnIndividualSearchIDs()
  'This is for the case where a All is chosen for constituency.
  'Return an array of String that contains IDs for individuals in Infinity.
  'Access an individual search feature in Infinity with the Constituent catalog
  'web API WebAPIClient DLL. The get IDs request requires a sevice provider. 
  'The service provider is established by Blackbaud Internet Solutions: 
  'Me.AP.AppFxWebServiceProvider. This uses BBNCExtensions.
  Dim IndividualSearchFilter As New Blackbaud.AppFx.Constituent.Catalog.WebApiClient.SearchLists.Constituent.IndividualSearchFilterData
  Dim IndividualIDs As String()
  IndividualSearchFilter.FIRSTNAME = TextBoxFirst.Text
  IndividualSearchFilter.MIDDLENAME = TextBoxMiddle.Text
  IndividualSearchFilter.KEYNAME = TextBoxLast.Text
  IndividualSearchFilter.INCLUDEINDIVIDUALS = True
  IndividualSearchFilter.INCLUDEGROUPS = False
  IndividualSearchFilter.INCLUDEINACTIVE = False
  IndividualSearchFilter.INCLUDENONCONSTITUENTRECORDS = False
  IndividualSearchFilter.INCLUDEORGANIZATIONS = False
  IndividualIDs = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.SearchLists.Constituent.IndividualSearch.GetIDs(Me.API.AppFxWebServiceProvider, IndividualSearchFilter)
  Return IndividualIDs
End Function</code></pre></div> </div> <p>Add code to return constituent IDs for individuals. One function returns IDs for all individuals. The other function returns IDs based on a constituency.</p> <h4>Functions to Return Constituent Information</h4> <p>Add code that uses the Infinity web API to retrieve and return constituent information.</p> <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Private Function GetConstituentSummary(ByVal ConstituentID As System.Guid)
    'Use the Constituent catalog WebAPIClient DLL to get constituent summary
    'information from Infinity. The create request and load data calls
    'require a sevice provider. The service provider is established by Blackbaud
    'Internet Solutions: Me.AP.AppFxWebServiceProvider. This uses BBNCExtensions.
    'The load data call uses the constituent summary request. Return the summary.
    Dim _ConstituentSummary As New Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentSummaryProfileViewFormData
    Dim ConstituentSummaryReq = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentSummaryProfileViewForm.CreateRequest(Me.API.AppFxWebServiceProvider)
    ConstituentSummaryReq.RecordID = ConstituentID.ToString
    _ConstituentSummary = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentSummaryProfileViewForm.LoadData(Me.API.AppFxWebServiceProvider, ConstituentSummaryReq)
    Return _ConstituentSummary
End Function

Private Function GetConstituentName(ByVal ConstituentID As System.Guid)
    'Use the Constituent catalog WebAPIClient DLL to get constituent name
    'information from Infinity. The create request and load data calls
    'require a sevice provider. The service provider is established by Blackbaud
    'Internet Solutions: Me.AP.AppFxWebServiceProvider. This uses BBNCExtensions.
    'The load data call uses the constituent name request. Return the name data.
    Dim _ConstituentName As New Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentFirstNameLastNameViewFormData
    Dim ConstituentNameReq = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentFirstNameLastNameViewForm.CreateRequest(Me.API.AppFxWebServiceProvider)
    ConstituentNameReq.RecordID = ConstituentID.ToString
    _ConstituentName = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentFirstNameLastNameViewForm.LoadData(Me.API.AppFxWebServiceProvider, ConstituentNameReq)
    Return _ConstituentName
End Function</code></pre></div> </div> <h4>Procedure for Display</h4> <p>Add code to display constituent information.</p> <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Private Sub DisplayIndividualInformation(ByVal ConstituentSummary As Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentSummaryProfileViewFormData,
                                             ByVal ConstituentName As Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentFirstNameLastNameViewFormData)
      'Display consituent name and summary information. The information is passed
      'to this procedure.
      If ConstituentName.FIRSTNAME &lt;&gt; "" Then
          LabelName.Text = ConstituentName.FIRSTNAME.ToString + " " + ConstituentName.KEYNAME.ToString
      Else
          LabelName.Text = ConstituentName.KEYNAME + " (last name only)"
      End If
      If ConstituentSummary.PHONENUMBER &lt;&gt; "" Then
          LabelPhone.Text = ConstituentSummary.PHONENUMBER.ToString
      Else
          LabelPhone.Text = "No phone number listed"
      End If
      If ConstituentSummary.EMAILADDRESS &lt;&gt; "" Then
          LabelEmail.Text = ConstituentSummary.EMAILADDRESS.ToString
      Else
          LabelEmail.Text = "No email address listed"
      End If

  End Sub</code></pre></div> </div> <h4>Button Click for Search</h4> <p>Add code to perform an individual search based on the part's content (which constituency).</p> <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Protected Sub ButtonSearch_Click(ByVal sender As Object, ByVal e As EventArgs) Handles ButtonSearch.Click
    Dim IndividualIDs() As String
    Dim ConstituentID As System.Guid
    Dim ConstituentSummary As Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentSummaryProfileViewFormData
    Dim ConstituentName As Blackbaud.AppFx.Constituent.Catalog.WebApiClient.ViewForms.Constituent.ConstituentFirstNameLastNameViewFormData

    ListBoxOtherResults.Items.Clear()

    'ReturnIndividualSearchIDs returns results for all constituencies or 
    'results for just one depending on whether you specify a constituency ID.
    If MyContent.SearchAll Then
        IndividualIDs = ReturnIndividualSearchIDs()
    Else
        IndividualIDs = ReturnIndividualSearchIDs(MyContent.ConstituencyID)
    End If

    'Logic for when the button is clicked.
    If IndividualIDs.Length = 0 Then
        LabelName.Text = "No results"
    ElseIf IndividualIDs.Length = 1 Then
        ConstituentID = New System.Guid(IndividualIDs(0))
        ConstituentSummary = GetConstituentSummary(ConstituentID)
        ConstituentName = GetConstituentName(ConstituentID)
        DisplayIndividualInformation(ConstituentSummary, ConstituentName)
    Else
        ConstituentID = New System.Guid(IndividualIDs(0))
        ConstituentSummary = GetConstituentSummary(ConstituentID)
        ConstituentName = GetConstituentName(ConstituentID)
        DisplayIndividualInformation(ConstituentSummary, ConstituentName)
        For Each IndResult In IndividualIDs
            ConstituentID = New System.Guid(IndResult)
            ConstituentName = GetConstituentName(ConstituentID)
            ListBoxOtherResults.Items.Add(ConstituentName.FIRSTNAME + " " + ConstituentName.KEYNAME)
        Next
    End If

End Sub</code></pre></div> </div> <h4>Editor Behavior</h4> <p>Add code to the editor form to populate a radio button list of constituencies. Also add code to update the part's content based on the selection in the editor form.</p> <div class="highlight-wrapper"> <div class="copy-code" title="Copy to Clipboard" data-trigger="manual" data-placement="left" data-container="body"> <i class="fa fa-files-o"></i> </div> <div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet">Imports BBNCExtensions

Partial Public Class CustomSearchFormEditor
    Inherits BBNCExtensions.Parts.CustomPartEditorBase

    Private mContent As CustomSearchFormProperties

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    End Sub

    Public Overrides Sub OnLoadContent()
        Dim ConstituencyAll() As Blackbaud.AppFx.Constituent.Catalog.WebApiClient.DataLists.TopLevel.ConstituencyAllDataListRow
        ConstituencyAll = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.DataLists.TopLevel.ConstituencyAllDataList.GetRows(Me.API.AppFxWebServiceProvider)

        With MyContent
            If Not Page.IsPostBack Then
                RadioButtonListConstituencies.Items.Clear()
                For Each Constituency In ConstituencyAll
                    RadioButtonListConstituencies.Items.Add(Constituency.DISPLAYNAME)
                Next
                RadioButtonListConstituencies.Items.Add("All")
                RadioButtonListConstituencies.SelectedValue = .Constituency
            End If
        End With
    End Sub

    Public Overrides Function OnSaveContent(Optional ByVal bDialogIsClosing As Boolean = True) As Boolean
        Dim ConstituencyAll() As Blackbaud.AppFx.Constituent.Catalog.WebApiClient.DataLists.TopLevel.ConstituencyAllDataListRow
        ConstituencyAll = Blackbaud.AppFx.Constituent.Catalog.WebApiClient.DataLists.TopLevel.ConstituencyAllDataList.GetRows(Me.API.AppFxWebServiceProvider)

        With MyContent
            .Constituency = RadioButtonListConstituencies.SelectedValue
            .SearchAll = False
            If .Constituency = "All" Then
                .SearchAll = True
            Else
                For Each Constituency In ConstituencyAll
                    If Constituency.DESCRIPTION = .Constituency Then
                        .ConstituencyID = Constituency.ID
                    End If
                Next
            End If
        End With
        Me.Content.SaveContent(MyContent)
        Return True
    End Function

    Private ReadOnly Property MyContent() As CustomSearchFormProperties
        Get
            If mContent Is Nothing Then
                mContent = Me.Content.GetContent(GetType(CustomSearchFormProperties))
                If mContent Is Nothing Then
                    mContent = New CustomSearchFormProperties
                End If
            End If
            Return mContent
        End Get
    End Property
End Class</code></pre></div> </div> <h3 id="example-blackbaud-secure-payments">Blackbaud Secure Payments</h3> <p>Blackbaud developer Joseph Styons has an <a href="http://www.bbdevnetwork.com/blogs/using-blackbaud-secure-payments-from-a-custom-bbis-part-part-one/" target="_blank" class="alert-link">article on the Blackbaud Developer Network</a>. Check out his article for another great example of using Blackbaud Secure Payments in a Custom Framework Part.</p> <p>Check back soon for an updated example of using Blackbaud Secure Payments.</p> </div> <!-- .col-md-9 --> </div> <!-- .row --> </div> <!-- .container --> </div> <!-- .content --> <div class="footer"> <div class="container"> <div class="row"> <div class="col-xs-6 col-sm-4"> <p> <a href="/bbis"> <img src="/bbis/assets/img/logo-lonely.png" alt="Blackbaud Internet Solutions" class="img-responsive" /> </a> </p> <ul class="list-unstyled"> <li> <a href="/bbis/start/">Getting Started</a> </li> <li> <a href="/bbis/guide/">Developer Guide</a> </li> <li> <a href="/bbis/reference/">Technical Reference</a> </li> <li> <a href="/bbis/code/">Code Samples</a> </li> <li> <a href="/bbis/help/">Help</a> </li> </ul> <!-- .list-unstyled --> </div> <!-- .col-sm-4 --> <div class="col-xs-6 col-sm-4"> <p> <a href="http://www.bbdevnetwork.com" target="_blank"> <img src="/bbis/assets/img/logo-developer-small.png" alt="Blackbaud Developer Network" class="img-responsive" /> </a> </p> <ul class="list-unstyled"> <li> <a href="https://www.blackbaud.com/nonprofit-resources/sdk-resources.aspx" target="_blank"> Blackbaud Infinity SDK </a> </li> <li> <a href="http://open.convio.com/" target="_blank"> Blackbaud Luminate </a> </li> <li> <a href="https://www.blackbaud.com/files/support/netcommunity-developer/netcommunity-developer.htm" target="_blank"> Blackbaud NetCommunity </a> </li> <li> <a href="https://www.blackbaud.com/files/support/guides/re7ent/api.pdf" target="_blank"> Blackbaud Raiser's Edge </a> </li> <li> <a href="http://developer.everydayhero.com" target="_blank"> Everyday Hero </a> </li> </ul> <!-- .list-unstyled --> </div> <!-- .col-sm-4 --> <div class="col-sm-4"> <div class="row"> <div class="col-sm-12"> <ul class="list-inline bb-love"> <li> <a href="http://www.blackbaud.com" target="_blank"> <img src="/bbis/assets/img/logo-bb-white.png" alt="Blackbaud" class="img-responsive" /> </a> </li> <li> <i class="fa fa-lg fa-plus"></i> </li> <li> <a href="http://www.github.com/blackbaud-community" target="_blank"> <img src="/bbis/assets/img/logo-github.png" alt="GitHub" class="img-responsive" /> </a> </li> </ul> <!-- .list-inline --> </div> <!-- .col-sm-12 --> </div> <!-- .row --> <div class="row"> <div class="col-sm-12"> <ul class="list-inline social-icons"> <li> <a href="https://github.com/blackbaud-community" target="_blank"> <i class="fa fa-github"></i> </a> </li> <li> <a href="https://plus.google.com/113382459921828617974" target="_blank"> <i class="fa fa-google-plus"></i> </a> </li> <li> <a href="http://twitter.com/blackbaud" target="_blank"> <i class="fa fa-twitter"></i> </a> </li> <li> <a href="https://www.facebook.com/blackbaud" target="_blank"> <i class="fa fa-facebook"></i> </a> </li> <li> <a href="http://www.youtube.com/user/blackbaudinc" target="_blank"> <i class="fa fa-youtube"></i> </a> </li> </ul> <!-- .list-inline --> </div> <!-- .col-sm-12 --> </div> <!-- .row --> </div> <!-- .col-sm-4 --> </div> <!-- .row --> </div> <!-- .container --> </div> <!-- .footer --> <div class="copyright"> <div class="container"> <div class="row"> <div class="col-sm-6"> <p>&copy; 2014 Blackbaud, Inc. All rights reserved.</p> </div> <div class="col-sm-6"> <p class="feedback-link"> <a href="/bbis/help/">Provide Feedback</a> </p> </div> </div> </div> </div> <!-- .copyright --> <div id="omnibar"> &nbsp; </div> <script src="//code.jquery.com/jquery-1.11.1.min.js"></script> <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script> <script src="/bbis/assets/js/combine.site.js?v=2018-11-01-18:16:41"></script> </body> </html>